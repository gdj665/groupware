<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goodee.groupware.mapper.DepartmentMapper">
	<!-- 부서 리스트 계층형쿼리 사용해서 출력 -->
	<select id="getDepartmentList" resultType="java.util.Map">
		SELECT d1.`department_id` departmentId, d1.`department_no` departmentNo, d2.`department_id` departmentParentId FROM department d1 LEFT JOIN department d2 ON d1.`department_parent_no`= d2.`department_no` ORDER BY d1.`department_no` DESC
	</select>
	
	<!-- 부서 삭제 -->
	<delete id="deleteDepartment" parameterType="com.goodee.groupware.vo.Department">
		DELETE 
		FROM department
		WHERE department_no = #{departmentNo}
	</delete>
	
	<!-- 부서추가 -->
	<insert id="addDepartment" parameterType="com.goodee.groupware.vo.Department">
		<!-- insert 작업 이후에 실행되어 Department vo에 deparmentN로 선언되어 있는 값을 가져온다 -->
		<selectKey order="AFTER" keyProperty="departmentNo" resultType="int">
			SELECT last_isert_id()
		</selectKey>
		Insert INTO department(
			department_no,
			department_id,
			department_parent_no,
			createdate,
			updatedate
		) VALUES(
			#{departmentNo},
			#{departmentId},
			#{departmentParentNo},
			NOW(),
			NOW()
		)
	</insert>
	<!-- 사원 리스트 출력 -->
	<select id="getMemberList" resultType="java.util.Map">
		SELECT member_id memberId, department_no departmentNo, member_name memberName, member_level memberLevel
		FROM member
		ORDER BY memberLevel
	</select>
	
	<!-- 부서별 팀 리스트 출력 -->
	<select id="getTeamDepartment" parameterType="com.goodee.groupware.vo.Department" resultType="java.util.Map">
		SELECT department_id departmentId, department_no departmentNo FROM department WHERE department_parent_no = #{departmentNo} ORDER BY departmentId;
	</select>
</mapper>