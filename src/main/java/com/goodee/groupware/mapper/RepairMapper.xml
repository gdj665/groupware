<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goodee.groupware.mapper.RepairMapper">
	<!-- 1) repair테이블에 접수추가 -->
	<insert id="addRepair" parameterType="com.goodee.groupware.vo.Repair">
		INSERT INTO repair(
				repair_product_category, 
				repair_product_name, 
				receiving_date, 
				repair_status, 
				repair_receiving_reason, 
				createdate, 
				updatedate
		)
		VALUES(
				#{repairProductCategory}, 
				#{repairProductName}, 
				#{receivingDate}, 
				'대기중',  
				#{repairReceivingReason}, 
				NOW(), 
				NOW()
		)
	</insert>
	<!-- 2) as목록 리스트 (대기중, 수리중, 수리완료로 나뉨 -->
	<select id="getRepairList" resultType="java.util.Map" parameterType="java.util.Map">
		SELECT 
			repair_no repairNo,
			member_id memberId,
			repair_product_category repairProductCategory,
			repair_product_name repairProductName,
			receiving_date receivingDate,
			repair_date repairDate,
			repair_release_date repairReleaseDate,
			repair_price repairPrice,
			repair_status repairStatus,
			repair_receiving_reason repairReceivingReason,
			repair_content repairContent,
			createdate createdate,
			updatedate updatedate
		FROM repair
		<where>
			repair_status = #{repairStatus}
			<if test="repairProductCategory != null">
				AND	repair_product_category LIKE '%' #{repairProductCategory} '%'
			</if>
		</where>
		ORDER BY createdate DESC
		LIMIT #{beginRow}, #{rowPerPage}
	</select>
	
	<!-- 2.1) as목록 리스트 (대기중, 수리중, 수리완료로 나뉨) 총 행의 개수 -->
	<select id="getRepairListCnt" parameterType="java.util.Map">
		SELECT 
			COUNT(*)
		FROM repair
		<where>
			repair_status = #{repairStatus}
			<if test="repairProductCategory != null">
				AND	repair_product_category LIKE '%' #{repairProductCategory} '%'
			</if>
		</where>
	</select>
</mapper>