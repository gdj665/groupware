<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goodee.groupware.mapper.ScheduleMapper">
	<!-- 월 별 일정 (전체 or 개인 or 부서) -->
	<select id="getScheduleList" parameterType="java.util.Map" resultType="com.goodee.groupware.vo.Schedule">
		SELECT
			schedule_no scheduleNo,
 			schedule_category scheduleCategory,
			schedule_title scheduleTitle,
			schedule_content scheduleContent,
			schedule_begindate scheduleBegindate,
			schedule_enddate scheduleEnddate
		FROM schedule
		<where>
            <if test="scheduleCategory != null">
				schedule_category = #{scheduleCategory}
            </if>
            AND member_id = #{memberId}
            AND YEAR(schedule_begindate) = #{targetYear}
            AND MONTH(schedule_begindate) = #{targetMonth}
        </where>
	</select>
	
	<!-- 일 별 일정 상세보기 (전체 or 개인 or 부서) -->
	<select id="getOneSchedule" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			schedule_no scheduleNo,
			schedule_category scheduleCategory,
			schedule_title scheduleTitle,
			schedule_content scheduleContent,
			schedule_begindate scheduleBegindate,
			schedule_enddate scheduleEnddate
		FROM schedule
		<where>
            <if test="scheduleCategory != null">
				schedule_category = #{scheduleCategory}
            </if>
			AND member_id = #{memberId} 
			AND YEAR(schedule_begindate) = #{targetYear}
            AND MONTH(schedule_begindate) = #{targetMonth} 	
			AND DAY(schedule_begindate) = #{targetDate}
		</where>	
	</select>
	
	<!-- 일정 추가 -->
	<insert id="addSchedule" parameterType="com.goodee.groupware.vo.Schedule">
		INSERT INTO schedule(
			member_id,
			schedule_category,
			schedule_title,
			schedule_content,
			schedule_begindate,
			schedule_enddate,
			createdate,
			updatedate
		) VALUES(
			#{memberId},
			#{scheduleCategory},
			#{scheduleTitle},
			#{scheduleContent},
			#{scheduleBegindate},
			#{scheduleEnddate},
			NOW(),
			NOW()
		)	
	</insert>
	
	<!-- 부서장 유무 조회 -->
	<select id="getMemberLevelCount" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*)
		FROM member
		WHERE member_id = #{memberId} 
			AND member_level = #{memberLevel}
	</select>
	
	<!-- 일정 삭제 -->
	<delete id="deleteSchedule" parameterType="com.goodee.groupware.vo.Schedule">
		DELETE FROM schedule
		WHERE schedule_no = #{scheduleNo}
	</delete>	
</mapper>